@startuml ActivityDiagram_ProductSearch
!theme plain
title Диаграмма деятельности - Поиск и выбор товара

|Пользователь|
start
:Открыть главную страницу;

fork
  :Ввести поисковый запрос;
fork again
  :Выбрать категорию товаров;
fork again
  :Просмотреть рекомендации;
end fork

|Система|
:Обработать запрос;
:Выполнить поиск в базе данных;

if (Найдены результаты?) then (нет)
  :Показать сообщение "Ничего не найдено";
  :Предложить похожие товары;
  |Пользователь|
  if (Выбрать похожий товар?) then (нет)
    :Изменить поисковый запрос;
    |Система|
  else (да)
  endif
else (да)
endif

|Система|
:Отобразить результаты поиска;
:Показать фильтры;

|Пользователь|
:Просмотреть результаты;

repeat
  :Выбрать фильтры (цена, бренд, характеристики);
  |Система|
  :Применить фильтры;
  :Обновить результаты;
  |Пользователь|
repeat while (Применить еще фильтры?) is (да)
-> нет;

:Выбрать товар для просмотра;

|Система|
:Загрузить карточку товара;
:Показать характеристики;
:Загрузить отзывы;

|Пользователь|
:Изучить информацию о товаре;

if (Сравнить с другими товарами?) then (да)
  :Добавить в сравнение;
  :Выбрать другие товары для сравнения;
  |Система|
  :Показать таблицу сравнения;
  |Пользователь|
endif

if (Добавить в корзину?) then (да)
  |Система|
  if (Пользователь авторизован?) then (нет)
    :Предложить авторизацию;
    |Пользователь|
    :Авторизоваться или продолжить как гость;
    |Система|
  endif
  :Добавить товар в корзину;
  :Обновить счетчик корзины;
else (нет)
  if (Добавить в избранное?) then (да)
    |Система|
    if (Пользователь авторизован?) then (нет)
      :Предложить авторизацию;
      |Пользователь|
      :Авторизоваться;
      |Система|
    endif
    :Добавить в избранное;
  endif
endif

|Пользователь|
stop

@enduml
